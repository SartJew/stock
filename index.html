<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>SART JEWELS — Каталог</title>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TSST348JXS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TSST348JXS');
</script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #f7f7f7;
      color: #111111;
    }

    .topbar {
      background: #ffffff;
      border-bottom: 1px solid #e5e5e5;
    }
    .topbar-inner {
      max-width: 1080px;
      margin: 0 auto;
      padding: 10px 16px 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #777777;
    }
    .tb-left {
      font-weight: 600;
      color: #111111;
    }
    .tb-right {
      opacity: 0.7;
      text-align: right;
    }

    .page {
      max-width: 1080px;
      margin: 0 auto;
      padding: 18px 16px 60px;
    }
    header {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 16px;
      border-bottom: 1px solid #ececec;
      padding-bottom: 12px;
    }
    .logo {
      font-size: 22px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      font-weight: 500;
    }
    .logo span { font-weight: 600; }
    .subtitle {
      font-size: 13px;
      color: #666666;
      max-width: 520px;
      line-height: 1.5;
    }
        .contacts {
      font-size: 12px;
      color: #555555;
      margin-top: 2px;
    }
    .contacts a {
      color: inherit;
      text-decoration: underline;
      text-decoration-thickness: 0.06em;
      text-underline-offset: 0.18em;
    }

    .top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 6px;
      align-items: center;
      justify-content: space-between;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .filter-btn {
      border-radius: 999px;
      border: 1px solid #dddddd;
      padding: 6px 14px;
      font-size: 12px;
      background: #ffffff;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
      white-space: nowrap;
    }
    .filter-btn.active {
      background: #111111;
      color: #ffffff;
      border-color: #111111;
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    }

    .search {
      flex: 1 1 180px;
      min-width: 0;
    }
    .search input {
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid #dddddd;
      font-size: 13px;
      outline: none;
      background: #ffffff;
    }
    .search input:focus {
      border-color: #111111;
      box-shadow: 0 0 0 1px #1111110d;
    }

    .meta {
      font-size: 11px;
      color: #999999;
      margin: 8px 0 14px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
    }
    .card {
      background: #ffffff;
      border-radius: 14px;
      padding: 12px 12px 14px;
      border: 1px solid #e5e5e5;
      box-shadow: 0 4px 10px rgba(0,0,0,0.03);
      display: flex;
      flex-direction: column;
      min-height: 140px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, border-color 0.1s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
      border-color: #d5d5d5;
    }
    .card-inner {
      display: flex;
      gap: 10px;
    }
    .thumb {
      width: 88px;
      height: 88px;
      border-radius: 12px;
      overflow: hidden;
      flex-shrink: 0;
      background: #f1f1f1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #aaaaaa;
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .thumb.empty-text {
      padding: 6px;
      text-align: center;
      line-height: 1.3;
    }

    .card-body {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      flex: 1;
      min-width: 0;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
      gap: 4px;
    }
    .brand {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #999999;
    }
    .ref {
      font-size: 11px;
      color: #bbbbbb;
      white-space: nowrap;
    }
    .name {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
      line-height: 1.4;
    }
    .lot-meta {
      font-size: 11px;
      color: #777777;
      margin-bottom: 4px;
    }
    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      margin-top: 4px;
    }
    .price { font-weight: 600; }
    
   .status {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  padding: 3px 8px;
  border-radius: 999px;
  white-space: nowrap;
  border: 1px solid;
}

/* IN — зелёный */
.status.in {
  border-color: #c8e6c9;
  color: #2e7d32;
  background: #e8f5e9;
}

/* OUT — жёлтый */
.status.out {
  border-color: #ffe0b2;
  color: #e65100;
  background: #fff3e0;
}

/* RSV — красный */
.status.rsv {
  border-color: #ffcdd2;
  color: #b71c1c;
  background: #ffebee;
}
    
    /* КНОПКА "УТОЧНИТЬ" + МЕНЮ КОНТАКТОВ */
.card-actions {
  margin-top: 8px;
  position: relative;
}

.btn-inquire {
  font-size: 11px;
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid #cccccc;
  background: #fafafa;
  cursor: pointer;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  font-weight: 500;
  transition: background 0.15s ease, border-color 0.15s ease, transform 0.1s ease;
}

.btn-inquire:hover {
  background: #f0f0f0;
  border-color: #999999;
  transform: translateY(-1px);
}

.contact-menu {
  position: absolute;
  top: 110%;
  right: 0;
  background: #ffffff;
  border-radius: 10px;
  padding: 6px 8px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  display: none;
  gap: 6px;
  z-index: 10;
  white-space: nowrap;
}

.contact-menu.open {
  display: flex;
}

.contact-link {
  font-size: 11px;
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid #dddddd;
  text-decoration: none;
  color: #333333;
  background: #f9f9f9;
  transition: background 0.15s ease, border-color 0.15s ease, transform 0.1s ease;
}

.contact-link:hover {
  background: #f0f0f0;
  border-color: #aaaaaa;
  transform: translateY(-1px);
}
    
    footer {
      margin-top: 32px;
      font-size: 11px;
      color: #9a9a9a;
      border-top: 1px solid #e2e2e2;
      padding-top: 12px;
    }

    /* LIGHTBOX / ГАЛЕРЕЯ */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .lightbox.visible {
      display: flex;
    }
    .lightbox-inner {
      background: #000000;
      border-radius: 14px;
      max-width: 92vw;
      max-height: 92vh;
      padding: 10px 10px 12px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    }
    .lightbox-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #ffffff;
      font-size: 12px;
      margin-bottom: 6px;
      gap: 8px;
    }
    .lb-title {
      font-weight: 500;
      font-size: 13px;
    }
    .lb-ref {
      opacity: 0.7;
      font-size: 11px;
    }
    .lightbox-img-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      max-height: 70vh;
      margin-bottom: 6px;
    }
    .lightbox-img-wrap img {
      max-width: 100%;
      max-height: 70vh;
      display: block;
    }
    .lightbox-caption {
      color: #ffffff;
      font-size: 11px;
      opacity: 0.8;
      text-align: center;
      margin-bottom: 6px;
    }
    .lightbox-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #ffffff;
      font-size: 11px;
      gap: 6px;
    }
    .lb-btn {
      cursor: pointer;
      border: none;
      background: transparent;
      color: #ffffff;
      padding: 4px 8px;
      font-size: 11px;
      border-radius: 999px;
      opacity: 0.85;
    }
    .lb-btn.primary {
      border: 1px solid rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.06);
    }
    .lb-btn:hover {
      opacity: 1;
    }
    .lb-index {
      opacity: 0.7;
    }

    @media (max-width: 600px) {
      .page { padding: 16px 12px 40px; }
      .topbar-inner { padding-inline: 12px; font-size: 10px; }
      header { gap: 8px; }
      .lightbox-inner {
        max-width: 96vw;
        max-height: 94vh;
      }
      .lightbox-img-wrap img {
        max-height: 64vh;
      }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="tb-left"></div>
      <div class="tb-right">PRIVATE STOCK · MOSCOW</div>
    </div>
  </div>

  <div class="page">
    <header>
      <div class="logo"><span></span>WATCHES AND JEWELLRY</div>
      <div class="subtitle">
        Актуальный сток часов и ювелирных изделий. Только оригинал.
        В наличии в Москве, возможна проверка в сервис-центре. Цены указаны в долларах США.
      </div>
      <div class="contacts">
  Контакты:
  Telegram <a href="https://t.me/TheSart" target="_blank">@TheSart</a> ·
  WhatsApp <a href="https://wa.me/79260333480" target="_blank">+7 (926) 033-34-80</a>
</div>
      <div class="top-row">
        <div class="filters">
          <button class="filter-btn active" data-brand="all">Все бренды</button>
          <button class="filter-btn" data-brand="Rolex">Rolex</button>
          <button class="filter-btn" data-brand="Cartier">Cartier</button>
          <button class="filter-btn" data-brand="Graff">Graff</button>
        </div>
        <div class="search">
          <input id="search-input" type="text" placeholder="Поиск по модели, ref или бренду…" />
        </div>
      </div>
    </header>

    <div class="meta" id="meta-info">
      Статус: все лоты «в наличии». Один лот = конкретный экземпляр товара.
    </div>

    <main>
      <div class="grid" id="products-grid"></div>
    </main>

    <footer>
      Контакт: Данил (Sart), Москва. Каталог предназначен для личных клиентов и партнёров.
      Для уточнения наличия, живых фото и условий напишите напрямую.
    </footer>
  </div>

  <!-- LIGHTBOX / ГАЛЕРЕЯ -->
  <div class="lightbox" id="lightbox">
    <div class="lightbox-inner">
      <div class="lightbox-header">
        <div>
          <div class="lb-title" id="lb-title"></div>
          <div class="lb-ref" id="lb-ref"></div>
        </div>
        <button class="lb-btn" id="lb-close">Закрыть ✕</button>
      </div>
      <div class="lightbox-img-wrap">
        <img id="lb-img" src="" alt="" />
      </div>
      <div class="lightbox-caption" id="lb-caption"></div>
      <div class="lightbox-controls">
        <button class="lb-btn primary" id="lb-prev">← Предыдущее</button>
        <div class="lb-index" id="lb-index"></div>
        <button class="lb-btn primary" id="lb-next">Следующее →</button>
      </div>
    </div>
  </div>

  <script>
  const SHEET_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQQWmPmYviO64ky1rYJn1CRfUfYtcp8xVO3vg_gm8qVB4fZJEumVPxjm1DkYCOtRWaXvRA2hvNY4mv/pub?output=csv";

  const localProducts = [
    { id: "r-126233-1", brand: "Rolex", ref: "126233VI", name: "Datejust 36 · green dial", year: "2023", condition: "New", set: "Full set", price: "19 900 $", status: "in_stock", image: "" }
  ];

  let products = [];
  let currentBrand = "all";
  let currentQuery = "";

  const grid = document.getElementById("products-grid");
  const filterButtons = document.querySelectorAll(".filter-btn");
  const metaInfo = document.getElementById("meta-info");
  const searchInput = document.getElementById("search-input");

  // --- CSV парсер (устойчив к запятым/кавычкам/переносам) ---
  function parseCSV(text) {
    const rows = [];
    let row = [];
    let cell = "";
    let inQuotes = false;

    for (let i = 0; i < text.length; i++) {
      const c = text[i];
      const next = text[i + 1];

      if (inQuotes) {
        if (c === '"' && next === '"') { cell += '"'; i++; continue; }
        if (c === '"') { inQuotes = false; continue; }
        cell += c;
        continue;
      }

      if (c === '"') { inQuotes = true; continue; }
      if (c === ",") { row.push(cell); cell = ""; continue; }
      if (c === "\n") { row.push(cell); rows.push(row); row = []; cell = ""; continue; }
      if (c === "\r") continue;

      cell += c;
    }

    if (cell.length || row.length) { row.push(cell); rows.push(row); }
    return rows;
  }

  function norm(s) {
    return (s || "").toString().trim();
  }

 function normStatus(s) {
  const v = (s || "").toString().trim().toUpperCase();
  if (v === "IN") return "in";
  if (v === "OUT") return "out";
  if (v === "RSV") return "rsv";
  return "out"; // дефолт: если пусто/ошибка — считаем "под заказ"
}

  function normalizeProducts(list) {
    return list.map((p, idx) => {
      const brand = norm(p.brand);
      const ref = norm(p.ref);
      const id = norm(p.id);
      return {
        ...p,
        brand,
        ref,
        id: id || `auto-${brand.toLowerCase().replace(/\s+/g, "-")}-${ref.toLowerCase().replace(/\s+/g, "-")}-${idx + 1}`,
        status: normStatus(p.status),
        image: norm(p.image)
      };
    });
  }

  async function loadFromSheet() {
    try {
      const res = await fetch(SHEET_CSV_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("CSV fetch failed: " + res.status);
      const text = await res.text();

      const table = parseCSV(text).filter(r => r.some(x => norm(x).length));
      if (!table.length) throw new Error("Empty CSV");

      const header = table.shift().map(h => norm(h));
      const col = (name) => header.indexOf(name);

      // ожидаемые колонки: id, brand, ref, name, year, condition, set, price, status, image
      const idx = {
        id: col("id"),
        brand: col("brand"),
        ref: col("ref"),
        name: col("name"),
        year: col("year"),
        condition: col("condition"),
        set: col("set"),
        price: col("price"),
        status: col("status"),
        image: col("image")
      };

      const parsed = table.map(cols => ({
        id:        idx.id        >= 0 ? norm(cols[idx.id])        : "",
        brand:     idx.brand     >= 0 ? norm(cols[idx.brand])     : "",
        ref:       idx.ref       >= 0 ? norm(cols[idx.ref])       : "",
        name:      idx.name      >= 0 ? norm(cols[idx.name])      : "",
        year:      idx.year      >= 0 ? norm(cols[idx.year])      : "",
        condition: idx.condition >= 0 ? norm(cols[idx.condition]) : "",
        set:       idx.set       >= 0 ? norm(cols[idx.set])       : "",
        price:     idx.price     >= 0 ? norm(cols[idx.price])     : "",
        status:    idx.status    >= 0 ? norm(cols[idx.status])    : "in_stock",
        image:     idx.image     >= 0 ? norm(cols[idx.image])     : ""
      }));

      products = normalizeProducts(parsed);
      applyFilters();
    } catch (e) {
      console.error("Ошибка загрузки/парсинга CSV, использую fallback", e);
      products = normalizeProducts(localProducts);
      applyFilters();
    }
  }

  function applyFilters() {
    grid.innerHTML = "";

    const q = currentQuery.toLowerCase().trim();

    const visible = products.filter(p => {
      if (currentBrand !== "all" && p.brand !== currentBrand) return false;
      if (q) {
        const haystack = (p.brand + " " + p.ref + " " + p.name).toLowerCase();
        if (!haystack.includes(q)) return false;
      }
      return true;
    });

    if (visible.length === 0) {
      grid.innerHTML = "<div style='font-size:13px;color:#888;'>Нет лотов в наличии по заданным условиям.</div>";
      metaInfo.textContent = "Ничего не найдено. Проверьте фильтр бренда или запрос в поиске.";
      return;
    }

    metaInfo.textContent = `Показано лотов: ${visible.length}. Бренд: ${currentBrand === "all" ? "все" : currentBrand}.`;

    visible.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";

      const detailsLine = [
        "Год: " + (p.year || "—"),
        "Состояние: " + (p.condition || "—"),
        "Комплект: " + (p.set || "—")
      ].join(" · ");

      const images = (p.image || "")
        .split("|")
        .map(x => x.trim())
        .filter(x => x.length > 3);

      const hasImage = images.length > 0;
      const thumbHtml = hasImage
        ? `<img src="${images[0]}" alt="${p.name}">`
        : "Фото<br>по запросу";

      const message = encodeURIComponent(
        "Данил, привет! Хочу уточнить по наличию:\n\n" +
        `${p.brand || ""} ${p.ref || ""} — ${p.name || ""}\n` +
        (p.set ? `Комплект: ${p.set}\n` : "") +
        (p.price ? `Цена: ${p.price}\n` : "")
      );

      const telegramUrl = `https://t.me/TheSart?text=${message}`;
      const whatsappUrl = `https://wa.me/79260333480?text=${message}`;
      const statusMap = {
  in:  { text: "в наличии", className: "in"  },
  out: { text: "под заказ", className: "out" },
  rsv: { text: "в резерве", className: "rsv" }
};

const st = statusMap[p.status] || statusMap.out;

      card.innerHTML = `
        <div class="card-inner">
          <div class="thumb ${hasImage ? "" : "empty-text"}">${thumbHtml}</div>
          <div class="card-body">
            <div>
              <div class="card-header">
                <div class="brand">${p.brand}</div>
                <div class="ref">${p.ref}</div>
              </div>
              <div class="name">${p.name}</div>
              <div class="lot-meta">${detailsLine}</div>
            </div>
            <div>
              <div class="price-row">
                <div class="price">${p.price}</div>
                <div class="status ${st.className}">${st.text}</div>
              </div>
              <div class="card-actions">
                <button type="button" class="btn-inquire">Уточнить</button>
                <div class="contact-menu">
                  <a rel="noopener noreferrer" href="${telegramUrl}" target="_blank" class="contact-link">Telegram</a>
                  <a rel="noopener noreferrer" href="${whatsappUrl}" target="_blank" class="contact-link">WhatsApp</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;

      const inquireBtn = card.querySelector(".btn-inquire");
      const contactMenu = card.querySelector(".contact-menu");

    card.addEventListener("click", (e) => {
  if (e.target.closest(".btn-inquire") || e.target.closest(".contact-menu")) return;

  // Если НЕ в наличии и нет фото — сразу предлагаем написать
  if (p.status !== "in" && !hasImage) {
    document.querySelectorAll(".contact-menu.open").forEach(m => m.classList.remove("open"));
    contactMenu.classList.add("open");
    return;
  }

  // Если фото нет — тоже не открываем пустой lightbox
  if (!hasImage) {
    document.querySelectorAll(".contact-menu.open").forEach(m => m.classList.remove("open"));
    contactMenu.classList.add("open");
    return;
  }

  // В наличии + есть фото — открываем галерею
  openLightbox(p, images);
});

      inquireBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const isOpen = contactMenu.classList.contains("open");
        document.querySelectorAll(".contact-menu.open").forEach(m => m.classList.remove("open"));
        if (!isOpen) contactMenu.classList.add("open");
      });

      contactMenu.addEventListener("click", (e) => e.stopPropagation());

      grid.appendChild(card);
    });
  }

  filterButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      filterButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentBrand = btn.getAttribute("data-brand");
      applyFilters();
    });
  });

  searchInput.addEventListener("input", () => {
    currentQuery = searchInput.value;
    applyFilters();
  });

  document.addEventListener("click", () => {
    document.querySelectorAll(".contact-menu.open").forEach(m => m.classList.remove("open"));
  });

  loadFromSheet();
</script>

</body>
</html>
