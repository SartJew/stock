<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>SART JEWELS — Каталог</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #f7f7f7;
      color: #111111;
    }

    .topbar {
      background: #ffffff;
      border-bottom: 1px solid #e5e5e5;
    }
    .topbar-inner {
      max-width: 1080px;
      margin: 0 auto;
      padding: 10px 16px 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #777777;
    }
    .tb-left {
      font-weight: 600;
      color: #111111;
    }
    .tb-right {
      opacity: 0.7;
      text-align: right;
    }

    .page {
      max-width: 1080px;
      margin: 0 auto;
      padding: 18px 16px 60px;
    }
    header {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 16px;
      border-bottom: 1px solid #ececec;
      padding-bottom: 12px;
    }
    .logo {
      font-size: 22px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      font-weight: 500;
    }
    .logo span { font-weight: 600; }
    .subtitle {
      font-size: 13px;
      color: #666666;
      max-width: 520px;
      line-height: 1.5;
    }

    .top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 6px;
      align-items: center;
      justify-content: space-between;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .filter-btn {
      border-radius: 999px;
      border: 1px solid #dddddd;
      padding: 6px 14px;
      font-size: 12px;
      background: #ffffff;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
      white-space: nowrap;
    }
    .filter-btn.active {
      background: #111111;
      color: #ffffff;
      border-color: #111111;
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    }

    .search {
      flex: 1 1 180px;
      min-width: 0;
    }
    .search input {
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid #dddddd;
      font-size: 13px;
      outline: none;
      background: #ffffff;
    }
    .search input:focus {
      border-color: #111111;
      box-shadow: 0 0 0 1px #1111110d;
    }

    .meta {
      font-size: 11px;
      color: #999999;
      margin: 8px 0 14px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
    }
    .card {
      background: #ffffff;
      border-radius: 14px;
      padding: 12px 12px 14px;
      border: 1px solid #e5e5e5;
      box-shadow: 0 4px 10px rgba(0,0,0,0.03);
      display: flex;
      flex-direction: column;
      min-height: 140px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, border-color 0.1s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
      border-color: #d5d5d5;
    }
    .card-inner {
      display: flex;
      gap: 10px;
    }
    .thumb {
      width: 88px;
      height: 88px;
      border-radius: 12px;
      overflow: hidden;
      flex-shrink: 0;
      background: #f1f1f1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #aaaaaa;
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .thumb.empty-text {
      padding: 6px;
      text-align: center;
      line-height: 1.3;
    }

    .card-body {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      flex: 1;
      min-width: 0;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
      gap: 4px;
    }
    .brand {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #999999;
    }
    .ref {
      font-size: 11px;
      color: #bbbbbb;
      white-space: nowrap;
    }
    .name {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
      line-height: 1.4;
    }
    .lot-meta {
      font-size: 11px;
      color: #777777;
      margin-bottom: 4px;
    }
    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      margin-top: 4px;
    }
    .price { font-weight: 600; }
    .status {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #c8e6c9;
      color: #2e7d32;
      background: #e8f5e9;
      white-space: nowrap;
    }
    .status.sold {
      border-color: #ffcdd2;
      color: #b71c1c;
      background: #ffebee;
    }
    footer {
      margin-top: 32px;
      font-size: 11px;
      color: #9a9a9a;
      border-top: 1px solid #e2e2e2;
      padding-top: 12px;
    }

    /* LIGHTBOX / ГАЛЕРЕЯ */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .lightbox.visible {
      display: flex;
    }
    .lightbox-inner {
      background: #000000;
      border-radius: 14px;
      max-width: 92vw;
      max-height: 92vh;
      padding: 10px 10px 12px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    }
    .lightbox-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #ffffff;
      font-size: 12px;
      margin-bottom: 6px;
      gap: 8px;
    }
    .lb-title {
      font-weight: 500;
      font-size: 13px;
    }
    .lb-ref {
      opacity: 0.7;
      font-size: 11px;
    }
    .lightbox-img-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      max-height: 70vh;
      margin-bottom: 6px;
    }
    .lightbox-img-wrap img {
      max-width: 100%;
      max-height: 70vh;
      display: block;
    }
    .lightbox-caption {
      color: #ffffff;
      font-size: 11px;
      opacity: 0.8;
      text-align: center;
      margin-bottom: 6px;
    }
    .lightbox-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #ffffff;
      font-size: 11px;
      gap: 6px;
    }
    .lb-btn {
      cursor: pointer;
      border: none;
      background: transparent;
      color: #ffffff;
      padding: 4px 8px;
      font-size: 11px;
      border-radius: 999px;
      opacity: 0.85;
    }
    .lb-btn.primary {
      border: 1px solid rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.06);
    }
    .lb-btn:hover {
      opacity: 1;
    }
    .lb-index {
      opacity: 0.7;
    }

    @media (max-width: 600px) {
      .page { padding: 16px 12px 40px; }
      .topbar-inner { padding-inline: 12px; font-size: 10px; }
      header { gap: 8px; }
      .lightbox-inner {
        max-width: 96vw;
        max-height: 94vh;
      }
      .lightbox-img-wrap img {
        max-height: 64vh;
      }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="tb-left">SART JEWELS</div>
      <div class="tb-right">PRIVATE STOCK · MOSCOW</div>
    </div>
  </div>

  <div class="page">
    <header>
      <div class="logo"><span>SART</span> JEWELS</div>
      <div class="subtitle">
        Актуальный сток часов и ювелирных изделий. Только оригинал с проверяемой историей.
        В наличии в Москве, возможна проверка в сервис-центре. Цены указаны в долларах США.
      </div>
      <div class="top-row">
        <div class="filters">
          <button class="filter-btn active" data-brand="all">Все бренды</button>
          <button class="filter-btn" data-brand="Rolex">Rolex</button>
          <button class="filter-btn" data-brand="Cartier">Cartier</button>
          <button class="filter-btn" data-brand="Graff">Graff</button>
        </div>
        <div class="search">
          <input id="search-input" type="text" placeholder="Поиск по модели, ref или бренду…" />
        </div>
      </div>
    </header>

    <div class="meta" id="meta-info">
      Статус: все лоты «в наличии». Один лот = конкретный экземпляр товара.
    </div>

    <main>
      <div class="grid" id="products-grid"></div>
    </main>

    <footer>
      Контакт: Данил (Sart), Москва. Каталог предназначен для личных клиентов и партнёров.
      Для уточнения наличия, живых фото и условий напишите напрямую.
    </footer>
  </div>

  <!-- LIGHTBOX / ГАЛЕРЕЯ -->
  <div class="lightbox" id="lightbox">
    <div class="lightbox-inner">
      <div class="lightbox-header">
        <div>
          <div class="lb-title" id="lb-title"></div>
          <div class="lb-ref" id="lb-ref"></div>
        </div>
        <button class="lb-btn" id="lb-close">Закрыть ✕</button>
      </div>
      <div class="lightbox-img-wrap">
        <img id="lb-img" src="" alt="" />
      </div>
      <div class="lightbox-caption" id="lb-caption"></div>
      <div class="lightbox-controls">
        <button class="lb-btn primary" id="lb-prev">← Предыдущее</button>
        <div class="lb-index" id="lb-index"></div>
        <button class="lb-btn primary" id="lb-next">Следующее →</button>
      </div>
    </div>
  </div>

  <script>
    // 1. ССЫЛКА НА GOOGLE SHEETS (CSV)
    // ВСТАВЬ СЮДА свою working CSV-ссылку из таблицы
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/18wrgkSEC7SIc0BiZfgXlOMfLuKOHmwjltW5L7lXTMfs/edit?usp=sharing";

    // 2. ЛОКАЛЬНЫЙ СТОК — РЕЗЕРВ, если таблица недоступна
    const localProducts = [
      { id: "r-126233-1", brand: "Rolex", ref: "126233VI", name: "Datejust 36 · green dial", year: "2023", condition: "New", set: "Full set", price: "19 900 $", status: "in_stock", image: "" }
      // Остальные можешь не заполнять: это fallback
    ];

    let products = [];
    let currentBrand = "all";
    let currentQuery = "";

    const grid = document.getElementById("products-grid");
    const filterButtons = document.querySelectorAll(".filter-btn");
    const metaInfo = document.getElementById("meta-info");
    const searchInput = document.getElementById("search-input");

    // Элементы лайтбокса
    const lightbox = document.getElementById("lightbox");
    const lbImg = document.getElementById("lb-img");
    const lbTitle = document.getElementById("lb-title");
    const lbRef = document.getElementById("lb-ref");
    const lbCaption = document.getElementById("lb-caption");
    const lbIndex = document.getElementById("lb-index");
    const lbClose = document.getElementById("lb-close");
    const lbPrev = document.getElementById("lb-prev");
    const lbNext = document.getElementById("lb-next");

    let currentImages = [];
    let currentImageIndex = 0;

    function normalizeProducts(list) {
      return list.map((p, idx) => {
        if (!p.id || !p.id.trim()) {
          const baseBrand = (p.brand || "item").toLowerCase().replace(/\s+/g, "-");
          const baseRef = (p.ref || "ref").toLowerCase().replace(/\s+/g, "-");
          p.id = `auto-${baseBrand}-${baseRef}-${idx + 1}`;
        }
        return p;
      });
    }

    async function loadFromSheet() {
      if (!SHEET_CSV_URL || SHEET_CSV_URL === "ПОДСТАВЬ_СЮДА_СВОЮ_CSV_ССЫЛКУ") {
        products = normalizeProducts(localProducts);
        applyFilters();
        return;
      }
      try {
        const res = await fetch(SHEET_CSV_URL);
        const text = await res.text();
        const lines = text.split(/\r?\n/).filter(l => l.trim().length > 0);
        const header = lines.shift().split(",");

        const getIndex = name => header.indexOf(name);

        const idx = {
          id:        getIndex("id"),
          brand:     getIndex("brand"),
          ref:       getIndex("ref"),
          name:      getIndex("name"),
          year:      getIndex("year"),
          condition: getIndex("condition"),
          set:       getIndex("set"),
          price:     getIndex("price"),
          status:    getIndex("status"),
          image:     getIndex("image")
        };

        const parsed = lines.map((line, rowIndex) => {
          const cols = line.split(","); // поэтому внутри ячеек НЕ должно быть запятых
          const obj = {
            id:        idx.id        >= 0 ? (cols[idx.id]        || "").trim() : "",
            brand:     idx.brand     >= 0 ? (cols[idx.brand]     || "").trim() : "",
            ref:       idx.ref       >= 0 ? (cols[idx.ref]       || "").trim() : "",
            name:      idx.name      >= 0 ? (cols[idx.name]      || "").trim() : "",
            year:      idx.year      >= 0 ? (cols[idx.year]      || "").trim() : "",
            condition: idx.condition >= 0 ? (cols[idx.condition] || "").trim() : "",
            set:       idx.set       >= 0 ? (cols[idx.set]       || "").trim() : "",
            price:     idx.price     >= 0 ? (cols[idx.price]     || "").trim() : "",
            status:    idx.status    >= 0 ? (cols[idx.status]    || "").trim() : "",
            image:     idx.image     >= 0 ? (cols[idx.image]     || "").trim() : ""
          };
          return obj;
        });

        products = normalizeProducts(parsed);
        applyFilters();
      } catch (e) {
        console.error("Ошибка загрузки Google Sheets, используем локальный сток", e);
        products = normalizeProducts(localProducts);
        applyFilters();
      }
    }

    function applyFilters() {
      grid.innerHTML = "";

      const q = currentQuery.toLowerCase().trim();

      const visible = products.filter(p => {
        if (p.status !== "in_stock") return false;
        if (currentBrand !== "all" && p.brand !== currentBrand) return false;
        if (q) {
          const haystack = (p.brand + " " + p.ref + " " + p.name).toLowerCase();
          if (!haystack.includes(q)) return false;
        }
        return true;
      });

      if (visible.length === 0) {
        grid.innerHTML = "<div style='font-size:13px;color:#888;'>Нет лотов в наличии по заданным условиям.</div>";
        metaInfo.textContent = "Ничего не найдено. Проверьте фильтр бренда или запрос в поиске.";
        return;
      }

      metaInfo.textContent = `Показано лотов: ${visible.length}. Бренд: ${currentBrand === "all" ? "все" : currentBrand}.`;

      visible.forEach(p => {
        const card = document.createElement("div");
        card.className = "card";

        const detailsLine = [
          "Год: " + (p.year || "—"),
          "Состояние: " + (p.condition || "—"),
          "Комплект: " + (p.set || "—")
        ].join(" · ");

        const images = (p.image || "")
          .split("|")
          .map(x => x.trim())
          .filter(x => x.length > 3);

        const hasImage = images.length > 0;
        const thumbHtml = hasImage
          ? `<img src="${images[0]}" alt="${p.name}">`
          : "Фото<br>по запросу";

        card.innerHTML = `
          <div class="card-inner">
            <div class="thumb ${hasImage ? "" : "empty-text"}">
              ${thumbHtml}
            </div>
            <div class="card-body">
              <div>
                <div class="card-header">
                  <div class="brand">${p.brand}</div>
                  <div class="ref">${p.ref}</div>
                </div>
                <div class="name">${p.name}</div>
                <div class="lot-meta">${detailsLine}</div>
              </div>
              <div class="price-row">
                <div class="price">${p.price}</div>
                <div class="status">в наличии</div>
              </div>
            </div>
          </div>
        `;

        card.addEventListener("click", () => {
          if (!hasImage) {
            openLightbox(p, []); // покажем просто текст
          } else {
            openLightbox(p, images);
          }
        });

        grid.appendChild(card);
      });
    }

    function openLightbox(product, images) {
      currentImages = images;
      currentImageIndex = 0;

      lbTitle.textContent = product.brand + " · " + product.name;
      lbRef.textContent = product.ref ? "Ref: " + product.ref : "";
      lbCaption.textContent = [
        product.year ? "Год: " + product.year : "",
        product.condition ? "Состояние: " + product.condition : "",
        product.set ? "Комплект: " + product.set : ""
      ].filter(Boolean).join(" · ");

      if (currentImages.length === 0) {
        lbImg.src = "";
        lbImg.alt = "";
        lbIndex.textContent = "Фото по запросу";
        lbPrev.style.visibility = "hidden";
        lbNext.style.visibility = "hidden";
      } else {
        showLightboxImage(0);
        lbPrev.style.visibility = currentImages.length > 1 ? "visible" : "hidden";
        lbNext.style.visibility = currentImages.length > 1 ? "visible" : "hidden";
      }

      lightbox.classList.add("visible");
    }

    function showLightboxImage(index) {
      if (!currentImages.length) return;
      if (index < 0) index = currentImages.length - 1;
      if (index >= currentImages.length) index = 0;
      currentImageIndex = index;

      lbImg.src = currentImages[currentImageIndex];
      lbImg.alt = "";
      lbIndex.textContent = `${currentImageIndex + 1} / ${currentImages.length}`;
    }

    function closeLightbox() {
      lightbox.classList.remove("visible");
      currentImages = [];
      currentImageIndex = 0;
    }

    lbClose.addEventListener("click", closeLightbox);
    lbPrev.addEventListener("click", () => {
      if (currentImages.length > 1) {
        showLightboxImage(currentImageIndex - 1);
      }
    });
    lbNext.addEventListener("click", () => {
      if (currentImages.length > 1) {
        showLightboxImage(currentImageIndex + 1);
      }
    });

    lightbox.addEventListener("click", (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (!lightbox.classList.contains("visible")) return;
      if (e.key === "Escape") {
        closeLightbox();
      } else if (e.key === "ArrowLeft") {
        if (currentImages.length > 1) showLightboxImage(currentImageIndex - 1);
      } else if (e.key === "ArrowRight") {
        if (currentImages.length > 1) showLightboxImage(currentImageIndex + 1);
      }
    });

    filterButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        filterButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentBrand = btn.getAttribute("data-brand");
        applyFilters();
      });
    });

    searchInput.addEventListener("input", () => {
      currentQuery = searchInput.value;
      applyFilters();
    });

    loadFromSheet();
  </script>
</body>
</html>
